# gather - é«˜æ€§èƒ½HTTPé‡‡é›†åŒ…
gather æ˜¯ä¸€ä¸ªé€‚é…æ…¢/å¿«å“åº”ç½‘ç«™çš„HTTPæ•°æ®é‡‡é›†åŒ…ï¼Œå†…ç½®çµæ´»çš„è¶…æ—¶é…ç½®ã€è‡ªåŠ¨åŒ–Cookieç®¡ç†ã€ä»£ç†æ”¯æŒå’Œè¿æ¥æ± ä¼˜åŒ–ï¼Œä¸“ä¸ºç½‘é¡µæ•°æ®é‡‡é›†åœºæ™¯è®¾è®¡ã€‚

## ç‰¹æ€§
- ğŸš€ æ…¢/å¿«è¿æ¥ä¸€é”®åˆ‡æ¢ï¼šé»˜è®¤é€‚é…æ…¢å“åº”ç½‘ç«™ï¼Œå¯å¿«é€Ÿåˆ‡æ¢è‡³å¿«é€Ÿå¤±è´¥æ¨¡å¼
- â±ï¸ æ™ºèƒ½è¶…æ—¶ç®¡ç†ï¼šæ”¯æŒæ€»è¶…æ—¶è‡ªåŠ¨æ¨å¯¼ç»†åˆ†è¶…æ—¶ï¼Œå…¨å±€å…œåº•è¶…æ—¶ä¼˜å…ˆçº§æœ€é«˜
- ğŸ”Œ çµæ´»ä»£ç†æ”¯æŒï¼šå…¼å®¹æ™®é€šä»£ç†/å¸¦è®¤è¯ä»£ç†ï¼Œæ”¯æŒåŠ¨æ€åˆ‡æ¢
- ğŸ“¦ è¿æ¥æ± ä¼˜åŒ–ï¼šåˆç†çš„ç©ºé—²è¿æ¥ç®¡ç†ï¼Œå¹³è¡¡æ€§èƒ½ä¸èµ„æºå ç”¨
- ğŸª è‡ªåŠ¨åŒ–Cookieï¼šå†…ç½®CookieJarï¼Œè‡ªåŠ¨ç®¡ç†Cookieç”Ÿå‘½å‘¨æœŸ

## å¿«é€Ÿå¼€å§‹
### 1. å®‰è£…
```bash
go get -u github.com/yudeguang17/gather
```
### 2. å®ä¾‹åŒ–é‡‡é›†å™¨
### åœºæ™¯ 1ï¼šé»˜è®¤é…ç½®ï¼ˆæ…¢é€Ÿè¿æ¥ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ UseSlowConnConfigï¼‰
-  åŒ…åˆå§‹åŒ– (init) æ—¶å·²è‡ªåŠ¨è°ƒç”¨UseSlowConnConfig()ï¼Œé»˜è®¤é€‚é…æ…¢å“åº”ç½‘ç«™ï¼ˆæ€»è¶…æ—¶ 10 åˆ†é’Ÿï¼‰ï¼Œæ— éœ€é‡å¤è°ƒç”¨ï¼š
```go
   package main

import (
"github.com/yudeguang17/gather"
"time"
)

func main() {
// ç›´æ¥åˆ›å»ºé‡‡é›†å™¨ï¼Œé»˜è®¤å¯ç”¨æ…¢é€Ÿé…ç½®
// å‚æ•°1ï¼šUAç±»å‹ï¼ˆæ”¯æŒchrome/baidu/google/bing/360/ieç­‰ï¼‰
// å‚æ•°2ï¼šæ˜¯å¦å¼€å¯Cookieæ—¥å¿—ï¼ˆè°ƒè¯•ç”¨ï¼‰
ga := gather.NewGather("chrome", false)

	// è®¾ç½®å…¨å±€å…œåº•è¶…æ—¶ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼Œå»ºè®®ä¸é»˜è®¤æ€»è¶…æ—¶ä¸€è‡´ï¼‰
	ga.Client.Timeout = 10 * time.Minute
}
```
### åœºæ™¯ 2ï¼šå¿«é€Ÿè¿æ¥é…ç½®
æ‰‹åŠ¨åˆ‡æ¢è‡³å¿«é€Ÿé…ç½®ï¼ˆæ€»è¶…æ—¶ 30 ç§’ï¼‰ï¼Œé€‚é…å¿«é€Ÿå“åº”ç½‘ç«™ / éœ€è¦å¿«é€Ÿå¤±è´¥çš„åœºæ™¯ï¼š
```go
package main

import (
"github.com/yudeguang17/gather"
"time"
)

func main() {
// åˆ‡æ¢åˆ°å¿«é€Ÿè¿æ¥é…ç½®
gather.UseFastConnConfig()

	// åˆ›å»ºé‡‡é›†å™¨
	ga := gather.NewGather("chrome", false)
	
	// è®¾ç½®å…¨å±€å…œåº•è¶…æ—¶ï¼ˆä¸å¿«é€Ÿé…ç½®æ€»è¶…æ—¶ä¸€è‡´ï¼‰
	ga.Client.Timeout = 30 * time.Second
}
```
### åœºæ™¯ 3ï¼šè‡ªå®šä¹‰æ€»è¶…æ—¶é…ç½®
æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªå®šä¹‰æ€»è¶…æ—¶ï¼Œè‡ªåŠ¨æ¨å¯¼å„é˜¶æ®µç»†åˆ†è¶…æ—¶ï¼š
```go
package main

import (
"github.com/yudeguang17/gather"
"time"
)

func main() {
// è‡ªå®šä¹‰æ€»è¶…æ—¶ï¼š10ç§’ï¼Œå¿«è¿æ¥æ¨¡å¼ï¼Œè·³è¿‡TLSè¯ä¹¦éªŒè¯
// å‚æ•°1ï¼šæ€»è¶…æ—¶æ—¶é—´
// å‚æ•°2ï¼šæ˜¯å¦ä¸ºæ…¢è¿æ¥åœºæ™¯ï¼ˆtrue=æ…¢è¿æ¥ï¼Œfalse=å¿«è¿æ¥ï¼‰
// å‚æ•°3ï¼šæ˜¯å¦è·³è¿‡TLSè¯ä¹¦éªŒè¯
gather.SetGatherConfigByClientTimeout(10*time.Second, false, true)

	// åˆ›å»ºé‡‡é›†å™¨
	ga := gather.NewGather("chrome", false)
	
	// è®¾ç½®å…¨å±€å…œåº•è¶…æ—¶ï¼ˆä¸è‡ªå®šä¹‰æ€»è¶…æ—¶ä¸€è‡´ï¼‰
	ga.Client.Timeout = 10 * time.Second
}
```
3. åŸºç¡€ä½¿ç”¨ï¼šGET è¯·æ±‚ç¤ºä¾‹
```go
   package main

import (
"fmt"
"github.com/yudeguang17/gather"
"io/ioutil"
"time"
)

func main() {
// 1. é»˜è®¤æ…¢é€Ÿé…ç½®åˆ›å»ºé‡‡é›†å™¨
ga := gather.NewGather("chrome", false)
ga.Client.Timeout = 10 * time.Minute

	// 2. å‘é€GETè¯·æ±‚
	resp, err := ga.Client.Get("https://example.com")
	if err != nil {
		fmt.Printf("è¯·æ±‚å¤±è´¥ï¼š%v\n", err)
		return
	}
	defer resp.Body.Close()

	// 3. è¯»å–å“åº”å†…å®¹
	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		fmt.Printf("è¯»å–å“åº”å¤±è´¥ï¼š%v\n", err)
		return
	}

	// 4. è¾“å‡ºç»“æœ
	fmt.Printf("å“åº”çŠ¶æ€ç ï¼š%d\n", resp.StatusCode)
	fmt.Printf("å“åº”å†…å®¹ï¼š%s\n", string(body))
}
```
4. é«˜çº§ä½¿ç”¨ï¼šè¿æ¥æ± ä¼˜åŒ–ç¤ºä¾‹
   gather å†…ç½®è¿æ¥æ± ç®¡ç†ï¼Œå¯é€šè¿‡é…ç½®è°ƒæ•´è¿æ¥æ± å‚æ•°ï¼Œé€‚é…é«˜å¹¶å‘é‡‡é›†åœºæ™¯ï¼š
```go

   package main

import (
"fmt"
"github.com/yudeguang17/gather"
"sync"
"time"
)

func main() {
// 1. è‡ªå®šä¹‰è¿æ¥æ± é…ç½®ï¼ˆé«˜å¹¶å‘åœºæ™¯ï¼‰
// æ€»è¶…æ—¶5åˆ†é’Ÿï¼Œæ…¢è¿æ¥æ¨¡å¼
gather.SetGatherConfigByClientTimeout(5*time.Minute, true, true)

	// 2. åˆ›å»ºå•ä¸ªé‡‡é›†å™¨ï¼ˆå¤ç”¨è¿æ¥æ± ï¼‰
	ga := gather.NewGather("chrome", false)
	ga.Client.Timeout = 5 * time.Minute

	// 3. é«˜å¹¶å‘é‡‡é›†ï¼ˆå¤ç”¨è¿æ¥æ± ï¼‰
	var wg sync.WaitGroup
	urls := []string{
		"https://example.com/page1",
		"https://example.com/page2",
		"https://example.com/page3",
	}

	// å¹¶å‘æ•°æ§åˆ¶ï¼šé¿å…è¿æ¥æ± è¿‡è½½
	sem := make(chan struct{}, 10) // é™åˆ¶åŒæ—¶10ä¸ªè¯·æ±‚

	for _, url := range urls {
		wg.Add(1)
		sem <- struct{}{} // è·å–ä¿¡å·é‡

		go func(u string) {
			defer wg.Done()
			defer func() { <-sem }() // é‡Šæ”¾ä¿¡å·é‡

			resp, err := ga.Client.Get(u)
			if err != nil {
				fmt.Printf("é‡‡é›†%så¤±è´¥ï¼š%v\n", u, err)
				return
			}
			defer resp.Body.Close()

			fmt.Printf("é‡‡é›†%sæˆåŠŸï¼ŒçŠ¶æ€ç ï¼š%d\n", u, resp.StatusCode)
		}(url)
	}

	wg.Wait()
	fmt.Println("æ‰€æœ‰é‡‡é›†ä»»åŠ¡å®Œæˆ")
}
```
## æ ¸å¿ƒé…ç½®è¯´æ˜
| é…ç½®æ–¹å¼                | é€‚ç”¨åœºæ™¯                          | æ ¸å¿ƒç‰¹ç‚¹                                  |
|-------------------------|-----------------------------------|-------------------------------------------|
| é»˜è®¤é…ç½®ï¼ˆæ…¢é€Ÿï¼‰        | æ…¢å“åº”ç½‘ç«™ã€åŠ¨æ€ç”Ÿæˆé¡µé¢ã€æµ·å¤–ç½‘ç«™ | ResponseHeaderTimeout=0ï¼ˆæ— é™ç­‰å“åº”å¤´ï¼‰ï¼Œæ€»è¶…æ—¶ 10 åˆ†é’Ÿ |
| å¿«é€Ÿé…ç½®                | é™æ€é¡µé¢ã€å†…ç½‘æœåŠ¡ã€é«˜æ€§èƒ½ API     | æ‰€æœ‰è¶…æ—¶æ”¶ç´§è‡³ 1~5 ç§’ï¼Œæ€»è¶…æ—¶ 30 ç§’ï¼Œå¿«é€Ÿå¤±è´¥        |
| è‡ªå®šä¹‰æ€»è¶…æ—¶            | ä¸ªæ€§åŒ–é‡‡é›†éœ€æ±‚                    | æŒ‰é˜¶æ®µå æ¯”è‡ªåŠ¨åˆ†é…ç»†åˆ†è¶…æ—¶ï¼Œä¿è¯æ€»å’Œâ‰¤æ€»è¶…æ—¶        |
##å…³é”®æ³¨æ„äº‹é¡¹
ga.Client.Timeoutæ˜¯å…¨å±€å…œåº•è¶…æ—¶ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œæ‰€æœ‰é˜¶æ®µè¶…æ—¶æ€»å’Œä¸ä¼šçªç ´æ­¤å€¼ï¼›
æ…¢è¿æ¥åœºæ™¯ä¸‹ResponseHeaderTimeoutä¼šè‡ªåŠ¨è®¾ä¸º 0ï¼ˆæ— é™ç­‰å¾…å“åº”å¤´ï¼‰ï¼Œé Client.Timeoutå…œåº•ï¼›
é«˜å¹¶å‘é‡‡é›†æ—¶ï¼Œå»ºè®®é€šè¿‡ä¿¡å·é‡é™åˆ¶å¹¶å‘æ•°ï¼Œé¿å…è¿æ¥æ± è¿‡è½½ï¼›
å¸¦è®¤è¯ä»£ç†å¯ä½¿ç”¨NewGatherProxyHasPassUtilåˆ›å»ºé‡‡é›†å™¨ï¼Œå‚æ•°åŒ…å«ä»£ç†ç”¨æˆ·å / å¯†ç ã€‚